<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minimal PDF Viewer</title>
  <style>
    :root{--bar:#111;--bg:#0f1720;--muted:#9aa3ad}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:#fff}
    .toolbar{display:flex;align-items:center;gap:8px;padding:8px 12px;background:linear-gradient(180deg,var(--bar),#0b1220);box-shadow:0 1px 0 rgba(255,255,255,0.02)}
    .url{flex:1;min-width:0}
    input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#eee}
    button{background:#0ea5a0;border:none;padding:8px 10px;border-radius:6px;color:#042;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    main{height:calc(100% - 56px)}
    .viewer{width:100%;height:100%;border:0}
    .hint{padding:18px;color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <div class="toolbar">
    <div style="font-weight:600">PDF</div>
    <div class="url">
      <input id="urlInput" type="text" placeholder="Paste a PDF URL or use ?pdflink=... in the address bar" />
    </div>
    <button id="loadBtn">Load</button>
    <button id="openBtn" class="ghost">Open in new tab</button>
  </div>
  <main>
    <div id="hint" class="hint">No PDF loaded. Use <code>?pdflink=ENCODED_URL</code> in the address bar or paste a PDF URL above and click Load.</div>
    <iframe id="pdfFrame" class="viewer" hidden sandbox="allow-same-origin allow-scripts allow-popups allow-forms"></iframe>
  </main>

  <script>
    // Read variations of the query param: ?pdflink=...  OR malformed ?=... (some users typed that)
    function getPdfLinkFromQuery(){
      const q = location.search.replace(/^\?/, '');
      if(!q) return null;
      // Common case: pdflink=...
      const params = new URLSearchParams(location.search);
      if(params.has('pdflink')) return params.get('pdflink');
      // Older/ambiguous: ?=https://... or ?=pdflink
      // Try to detect a raw url after the first '=' or entire query as URL
      const raw = q.split('=')[1] || q;
      try{ const u = decodeURIComponent(raw); if(u.startsWith('http')) return u }catch(e){}
      if(q.startsWith('http')) return q;
      return null;
    }

    const input = document.getElementById('urlInput');
    const loadBtn = document.getElementById('loadBtn');
    const openBtn = document.getElementById('openBtn');
    const hint = document.getElementById('hint');
    const frame = document.getElementById('pdfFrame');

    function setPdf(url){
      if(!url) return;
      // Basic safety: require http or https
      if(!/^https?:\/\//i.test(url)){
        hint.textContent = 'Error: only http/https PDF links are supported.';
        return;
      }

      // Try to show PDF directly in an iframe (Chrome/Edge built-in viewer will handle it)
      frame.src = url;
      frame.hidden = false;
      hint.hidden = true;
      input.value = url;
      openBtn.disabled = false;
    }

    loadBtn.addEventListener('click', ()=>{
      setPdf(input.value.trim());
    });

    openBtn.addEventListener('click', ()=>{
      const u = input.value.trim(); if(!u) return; window.open(u, '_blank');
    });

    // Auto-load from query string if available
    const fromQuery = getPdfLinkFromQuery();
    if(fromQuery){
      try{ setPdf(decodeURIComponent(fromQuery)); }catch(e){ setPdf(fromQuery); }
    }

    // Minimal: show helpful message if browser blocks embedding due to headers
    frame.addEventListener('error', ()=>{
      hint.hidden = false; hint.textContent = 'Unable to embed the PDF. The server hosting the PDF may disallow framing (X-Frame-Options) â€” use "Open in new tab" or host the PDF on a server that allows embedding.';
      frame.hidden = true;
    });

  </script>
</body>
</html>
